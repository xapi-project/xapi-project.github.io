<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.20.0+tip"><meta name=description content><title>Event handling in the Control Plane - Xapi, Xenopsd and Xenstore :: XAPI Toolstack Developer Documentation</title><link href=/new-docs/images/favicon.png?1711635954 rel=icon type=image/png><link href=/new-docs/css/fontawesome-all.min.css?1711635954 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/new-docs/css/fontawesome-all.min.css?1711635954 rel=stylesheet></noscript><link href=/new-docs/css/nucleus.css?1711635954 rel=stylesheet><link href=/new-docs/css/auto-complete.css?1711635954 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/new-docs/css/auto-complete.css?1711635954 rel=stylesheet></noscript><link href=/new-docs/css/perfect-scrollbar.min.css?1711635954 rel=stylesheet><link href=/new-docs/css/fonts.css?1711635954 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/new-docs/css/fonts.css?1711635954 rel=stylesheet></noscript><link href=/new-docs/css/theme.css?1711635954 rel=stylesheet><link href=/new-docs/css/theme-red.css?1711635954 rel=stylesheet id=variant-style><link href=/new-docs/css/variant.css?1711635954 rel=stylesheet><link href=/new-docs/css/print.css?1711635954 rel=stylesheet media=print><link href=/new-docs/css/ie.css?1711635954 rel=stylesheet><script src=/new-docs/js/url.js?1711635954></script>
<script src=/new-docs/js/variant.js?1711635954></script>
<script>window.index_js_url="/new-docs/index.search.js";var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \"{0}\"",window.T_N_results_found="{1} results found for \"{0}\"",baseUriFull="https://xapi-project.github.io/new-docs/",window.variants&&variants.init(["red"])</script></head><body class="mobile-support html" data-url=/new-docs/toolstack/features/events/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next topbar-link" href=/new-docs/toolstack/features/HA/index.html title="High-Availability (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev topbar-link" href=/new-docs/toolstack/features/DR/index.html title="Disaster Recovery (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title='Table of Contents (CTRL+ALT+t)'><i class="fas fa-list-alt fa-fw"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/new-docs/index.html><span itemprop=name>XAPI Toolstack Developer Guide</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/new-docs/toolstack/index.html><span itemprop=name>The XAPI Toolstack</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/new-docs/toolstack/features/index.html><span itemprop=name>Features</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Event handling in the Control Plane - Xapi, Xenopsd and Xenstore</span><meta itemprop=position content="4"></li></ol></div><div class="default-animation progress"><div class=toc-wrapper><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#xapi>Xapi</a><ul><li><a href=#sending-events-from-the-xenapi>Sending events from the xenapi</a></li><li><a href=#receiving-events-from-xenopsd>Receiving events from xenopsd</a></li></ul></li><li><a href=#xenopsd>Xenopsd</a><ul><li><a href=#sending-events-to-xapi>Sending events to xapi</a></li><li><a href=#receiving-events-from-xenstore>Receiving events from xenstore</a></li></ul></li><li><a href=#xenstore>Xenstore</a><ul><li><a href=#sending-events-to-xenstore-clients>Sending events to xenstore clients</a></li><li><a href=#receiving-events-from-xenstore-clients>Receiving events from xenstore clients</a></li></ul></li></ul></nav></div></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=event-handling-in-the-control-plane---xapi-xenopsd-and-xenstore>Event handling in the Control Plane - Xapi, Xenopsd and Xenstore</h1><h2 id=introduction>Introduction</h2><p>Xapi, xenopsd and xenstore use a number of different events to obtain
indications that some state changed in dom0 or in the guests. The events
are used as an efficient alternative to polling all these states
periodically.</p><ul><li><strong>xenstore</strong> provides a very configurable approach in which each and
any key can be watched individually by a xenstore client. Once the
value of a watched key changes, xenstore will indicate to the client
that the value for that key has changed. An ocaml xenstore client
library provides a way for ocaml programs such as xenopsd,
message-cli and rrdd to provide high-level ocaml callback functions
to watch specific key. It&rsquo;s very common, for instance, for xenopsd
to watch specific keys in the xenstore keyspace of a guest and then
after receiving events for some or all of them, read other keys or
subkeys in xenstored to update its internal state mirroring the
state of guests and its devices (for instance, if the guest has pv
drivers and specific frontend devices have established connections
with the backend devices in dom0).</li><li><strong>xapi</strong> also provides a very configurable event mechanism in which
the xenapi can be used to provide events whenever a xapi object (for
instance, a VM, a VBD etc) changes state. This event mechanism is
very reliable and is extensively used by XenCenter to provide
real-time update on the XenCenter GUI.</li><li><strong>xenopsd</strong> provides a somewhat less configurable event mechanism,
where it always provides signals for all objects (VBDs, VMs
etc) whose state changed (so it&rsquo;s not possible to select a subset of
objects to watch for as in xenstore or in xapi). It&rsquo;s up to the
xenopsd client (eg. xapi) to receive these events and then filter
out or act on each received signal by calling back xenopsd and
asking it information for the specific signalled object.  The main
use in xapi for the xenopsd signals is to update xapi&rsquo;s database of
the current state of each object controlled by xenopsd (VBDs,
VMs etc).</li></ul><p>Given a choice between polling states and receiving events when the
state change, we should in general opt for receiving events in the code
in order to avoid adding bottlenecks in dom0 that will prevent the
scalability of XenServer to many VMs and virtual devices.</p><p><a href=#image-8589892e98ca47fe3fb052a4b2de232b class=lightbox-link><img src=/new-docs/toolstack/features/events/xapi-xenopsd-events.png alt="Connection of events between XAPI, xenopsd and xenstore, with main functions and data structures responsible for receiving and sending them" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-8589892e98ca47fe3fb052a4b2de232b><img src=/new-docs/toolstack/features/events/xapi-xenopsd-events.png alt="Connection of events between XAPI, xenopsd and xenstore, with main functions and data structures responsible for receiving and sending them" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=xapi>Xapi</h2><h3 id=sending-events-from-the-xenapi>Sending events from the xenapi</h3><p>A xenapi user client, such as XenCenter, the xe-cli or a python script,
can register to receive events from XAPI for specific objects in the
XAPI DB. XAPI will generate events for those registered clients whenever
the corresponding XAPI DB object changes.</p><p><a href=#image-991edc6935e51d285441debc29460311 class=lightbox-link><img src=/new-docs/toolstack/features/events/sending-events-from-xapi.png alt="Sending events from the xenapi" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-991edc6935e51d285441debc29460311><img src=/new-docs/toolstack/features/events/sending-events-from-xapi.png alt="Sending events from the xenapi" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This small python scripts shows how to register a simple event watch
loop for XAPI:</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> XenAPI
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> XenAPI<span style=color:#f92672>.</span>Session(<span style=color:#e6db74>&#34;http://xshost&#34;</span>)
</span></span><span style=display:flex><span>session<span style=color:#f92672>.</span>login_with_password(<span style=color:#e6db74>&#34;username&#34;</span>,<span style=color:#e6db74>&#34;password&#34;</span>)
</span></span><span style=display:flex><span>session<span style=color:#f92672>.</span>xenapi<span style=color:#f92672>.</span>event<span style=color:#f92672>.</span>register([<span style=color:#e6db74>&#34;VM&#34;</span>,<span style=color:#e6db74>&#34;pool&#34;</span>]) <span style=color:#75715e># register for events in the pool and VM objects                                                </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    events <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>xenapi<span style=color:#f92672>.</span>event<span style=color:#f92672>.</span>next() <span style=color:#75715e># block until a xapi event on a xapi DB object is available</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> event <span style=color:#f92672>in</span> events:
</span></span><span style=display:flex><span>      print <span style=color:#e6db74>&#34;received event op=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74> class=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74> ref=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (event[<span style=color:#e6db74>&#39;operation&#39;</span>], event[<span style=color:#e6db74>&#39;class&#39;</span>], event[<span style=color:#e6db74>&#39;ref&#39;</span>])                                      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> event[<span style=color:#e6db74>&#39;class&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;vm&#39;</span> <span style=color:#f92672>and</span> event[<span style=color:#e6db74>&#39;operatoin&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;mod&#39;</span>:
</span></span><span style=display:flex><span>        vm <span style=color:#f92672>=</span> event[<span style=color:#e6db74>&#39;snapshot&#39;</span>]
</span></span><span style=display:flex><span>        print <span style=color:#e6db74>&#34;xapi-event on vm: vm_uuid=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, power_state=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, current_operation=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (vm[<span style=color:#e6db74>&#39;uuid&#39;</span>],vm[<span style=color:#e6db74>&#39;name_label&#39;</span>],vm[<span style=color:#e6db74>&#39;power_state&#39;</span>],vm[<span style=color:#e6db74>&#39;current_operations&#39;</span>]<span style=color:#f92672>.</span>values())
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>except</span> XenAPI<span style=color:#f92672>.</span>Failure, e:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(e<span style=color:#f92672>.</span>details) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> e<span style=color:#f92672>.</span>details[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;EVENTS_LOST&#39;</span>:
</span></span><span style=display:flex><span>      session<span style=color:#f92672>.</span>xenapi<span style=color:#f92672>.</span>event<span style=color:#f92672>.</span>unregister([<span style=color:#e6db74>&#34;VM&#34;</span>,<span style=color:#e6db74>&#34;pool&#34;</span>])
</span></span><span style=display:flex><span>      session<span style=color:#f92672>.</span>xenapi<span style=color:#f92672>.</span>event<span style=color:#f92672>.</span>register([<span style=color:#e6db74>&#34;VM&#34;</span>,<span style=color:#e6db74>&#34;pool&#34;</span>])</span></span></code></pre></div><p> </p><h3 id=receiving-events-from-xenopsd>Receiving events from xenopsd</h3><p>Xapi receives all events from xenopsd via the function
xapi_xenops.events_watch() in its own independent thread. This is a
single-threaded function that is responsible for handling all of the
signals sent by xenopsd. In some situations with lots of VMs and virtual
devices such as VBDs, this loop may saturate a single dom0 vcpu, which
will slow down handling all of the xenopsd events and may cause the
xenopsd signals to accumulate unboundedly in the worst case in the
updates queue in xenopsd (see Figure 1).</p><p>The function xapi_xenops.events_watch() calls
xenops_client.UPDATES.get() to obtain a list of (barrier, 
barrier_events), and then it process each one of the barrier_event,
which can be one of the following events:</p><ul><li><strong>Vm id:</strong> something changed in this VM,
run xapi_xenops.update_vm() to query xenopsd about its state. The
function update_vm() will update power_state, allowed_operations,
console and guest_agent state in the xapi DB.</li><li><strong>Vbd id:</strong> something changed in this VM,
run xapi_xenops.update_vbd() to query xenopsd about its state. The
function update_vbd() will update currently_attached and connected
in the xapi DB.</li><li><strong>Vif id:</strong> something changed in this VM,
run xapi_xenops.update_vif() to query xenopsd about its state. The
function update_vif() will update activate and plugged state of in
the xapi DB.</li><li><strong>Pci id:</strong> something changed in this VM,
run xapi_xenops.update_pci() to query xenopsd about its state.</li><li><strong>Vgpu id:</strong> something changed in this VM,
run xapi_xenops.update_vgpu() to query xenopsd about its state.</li><li><strong>Task id:</strong> something changed in this VM,
run xapi_xenops.update_task() to query xenopsd about its state.
The function update_task() will update the progress of the task in
the xapi DB using the information of the task in xenopsd.</li></ul><p><a href=#image-c03ed55fec33b340d7ee5b5227af59a0 class=lightbox-link><img src=/new-docs/toolstack/features/events/receiving-events-from-xenopsd.png alt="Receiving events from xenopsd" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-c03ed55fec33b340d7ee5b5227af59a0><img src=/new-docs/toolstack/features/events/receiving-events-from-xenopsd.png alt="Receiving events from xenopsd" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>All the xapi_xenops.update_X() functions above will call
Xenopsd_client.X.stat() functions to obtain the current state of X from
xenopsd:</p><p><a href=#image-fb00647591f6adcca0639aa48f48cb65 class=lightbox-link><img src=/new-docs/toolstack/features/events/obtaining-current-state.png alt="Obtaining current state" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-fb00647591f6adcca0639aa48f48cb65><img src=/new-docs/toolstack/features/events/obtaining-current-state.png alt="Obtaining current state" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>There are a couple of optimisations while processing the events in
xapi_xenops.events_watch():</p><ul><li>if an event X=(vm_id,dev_id) (eg. Vbd dev_id) has already been
processed in a barrier_events, it&rsquo;s not processed again. A typical
value for X is eg. &ldquo;&lt;vm_uuid>.xvda&rdquo; for a VBD.</li><li>if Events_from_xenopsd.are_supressed X, then this event
is ignored. Events are supressed if VM X.vm_id is migrating away
from the host</li></ul><h4 id=barriers>Barriers</h4><p>When xapi needs to execute (and to wait for events indicating completion
of) a xapi operation (such as VM.start and VM.shutdown) containing many
xenopsd sub-operations (such as VM.start – to force xenopsd to change
the VM power_state, and VM.stat, VBD.stat, VIF.stat etc – to force the
xapi DB to catch up with the xenopsd new state for these objects), xapi
sends to the xenopsd input queue a barrier, indicating that xapi will
then block and only continue execution of the barred operation when
xenopsd returns the barrier. The barrier should only be returned when
xenopsd has finished the execution of all the operations requested by
xapi (such as VBD.stat and VM.stat in order to update the state of the
VM in the xapi database after a VM.start has been issued to xenopsd). </p><p>A recent problem has been detected in the xapi_xenops.events_watch() 
function: when it needs to process many VM_check_state events, this
may push for later the processing of barriers associated with a
VM.start, delaying xapi in reporting (via a xapi event) that the VM
state in the xapi DB has reached the running power_state. This needs
further debugging, and is probably one of the reasons in CA-87377 why in
some conditions a xapi event reporting that the VM power_state is
running (causing it to go from yellow to green state in XenCenter) is
taking so long to be returned, way after the VM is already running.</p><h2 id=xenopsd>Xenopsd</h2><p>Xenopsd has a few queues that are used by xapi to store commands to be
executed (eg. VBD.stat) and update events to be picked up by xapi. The
main ones, easily seen at runtime by running the following command in
dom0, are:</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># xenops-cli diagnostics --queue=org.xen.xapi.xenops.classic</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>   queues: <span style=color:#f92672>[</span>  <span style=color:#75715e># XENOPSD INPUT QUEUE</span>
</span></span><span style=display:flex><span>            ... stuff that still needs to be processed by xenopsd
</span></span><span style=display:flex><span>            VM.stat
</span></span><span style=display:flex><span>            VBD.stat
</span></span><span style=display:flex><span>            VM.start
</span></span><span style=display:flex><span>            VM.shutdown
</span></span><span style=display:flex><span>            VIF.plug
</span></span><span style=display:flex><span>            etc
</span></span><span style=display:flex><span>           <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>   workers: <span style=color:#f92672>[</span> <span style=color:#75715e># XENOPSD WORKER THREADS</span>
</span></span><span style=display:flex><span>            ... which stuff each worker thread is processing
</span></span><span style=display:flex><span>   <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>   updates: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>     updates: <span style=color:#f92672>[</span> <span style=color:#75715e># XENOPSD OUTPUT QUEUE</span>
</span></span><span style=display:flex><span>            ... signals from xenopsd that need to be picked up by xapi
</span></span><span style=display:flex><span>               VM_check_state
</span></span><span style=display:flex><span>               VBD_check_state
</span></span><span style=display:flex><span>               etc
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span> tasks: <span style=color:#f92672>[</span> <span style=color:#75715e># XENOPSD TASKS</span>
</span></span><span style=display:flex><span>               ... state of each known task, before they are manually deleted after completion of the task
</span></span><span style=display:flex><span>               <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><h3 id=sending-events-to-xapi>Sending events to xapi</h3><p>Whenever xenopsd changes the state of a XenServer object such as a VBD
or VM, or when it receives an event from xenstore indicating that the
states of these objects have changed (perhaps because either a guest or
the dom0 backend changed the state of a virtual device), it creates a
signal for the corresponding object (VM_check_state, VBD_check_state
etc) and send it up to xapi. Xapi will then process this event in its
xapi_xenops.events_watch() function.</p><p><a href=#image-b5c3bda77698d4f5fa6f8457ab53eae7 class=lightbox-link><img src=/new-docs/toolstack/features/events/sending-events-to-xapi.png alt="Sending events to xapi" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-b5c3bda77698d4f5fa6f8457ab53eae7><img src=/new-docs/toolstack/features/events/sending-events-to-xapi.png alt="Sending events to xapi" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>These signals may need to wait a long time to be processed if the
single-threaded xapi_xenops.events_watch() function is having
difficulties (ie taking a long time) to process previous signals in the
UPDATES queue from xenopsd.  </p><h3 id=receiving-events-from-xenstore>Receiving events from xenstore</h3><p>Xenopsd watches a number of keys in xenstore, both in dom0 and in each
guest. Xenstore is responsible to send watch events to xenopsd whenever
the watched keys change state. Xenopsd uses a xenstore client library to
make it easier to create a callback function that is called whenever
xenstore sends these events.</p><p><a href=#image-6a46bbdd3ae43529eb1b6057d8e9987b class=lightbox-link><img src=/new-docs/toolstack/features/events/receiving-events-from-xenstore.png alt="Receiving events from xenstore" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-6a46bbdd3ae43529eb1b6057d8e9987b><img src=/new-docs/toolstack/features/events/receiving-events-from-xenstore.png alt="Receiving events from xenstore" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Xenopsd also needs to complement sometimes these watch events with
polling of some values. An example is the @introduceDomain event in
xenstore (handled in xenopsd/xc/xenstore_watch.ml), which indicates
that a new VM has been created. This event unfortunately does not
indicate the domid of the VM, and xenopsd needs to query Xen (via libxc)
which domains are now available in the host and compare with the
previous list of known domains, in order to figure out the domid of the
newly introduced domain.</p><p> It is not good practice to poll xenstore for changes of values. This
will add a large overhead to both xenstore and xenopsd, and decrease the
scalability of XenServer in terms of number of VMs/host and virtual
devices per VM. A much better approach is to rely on the watch events of
xenstore to indicate when a specific value has changed in xenstore.</p><h2 id=xenstore>Xenstore</h2><h3 id=sending-events-to-xenstore-clients>Sending events to xenstore clients</h3><p>If a xenstore client has created watch events for a key, then xenstore
will send events to this client whenever this key changes state.</p><h3 id=receiving-events-from-xenstore-clients>Receiving events from xenstore clients</h3><p>Xenstore clients indicate to xenstore that something state changed by
writing to some xenstore key. This may or may not cause xenstore to
create watch events for the corresponding key, depending on if other
xenstore clients have watches on this key.</p><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation><div id=header-topbar class=default-animation></div><div id=header-wrapper class=default-animation><div id=header class=default-animation><img src=https://xapi-project.github.io/new-docs//images/xapi-project.png></div><div class="searchbox default-animation"><i class="fas fa-search" title="Search (CTRL+ALT+f)"></i>
<label class=a11y-only for=search-by>Search</label>
<input data-search-input id=search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div><script>var contentLangs=["en"]</script><script src=/new-docs/js/auto-complete.js?1711635954 defer></script>
<script src=/new-docs/js/lunr/lunr.min.js?1711635954 defer></script>
<script src=/new-docs/js/lunr/lunr.stemmer.support.min.js?1711635954 defer></script>
<script src=/new-docs/js/lunr/lunr.multi.min.js?1711635954 defer></script>
<script src=/new-docs/js/lunr/lunr.en.min.js?1711635954 defer></script>
<script src=/new-docs/js/search.js?1711635954 defer></script></div><div id=homelinks class="default-animation homelinks"><ul><li><a class=padding href=/new-docs/index.html><i class="fas fa-home"></i> Home</a></li></ul><hr class=padding></div><div id=content-wrapper class=highlightable><div id=topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/new-docs/toolstack/index.html class=parent><input type=checkbox id=section-733bfb8b221c6a3949d666444cf4445d aria-controls=subsections-733bfb8b221c6a3949d666444cf4445d checked><label for=section-733bfb8b221c6a3949d666444cf4445d><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu The Toolstack</span></label><a class=padding href=/new-docs/toolstack/index.html>The Toolstack</a><ul id=subsections-733bfb8b221c6a3949d666444cf4445d class="morespace collapsible-menu"><li data-nav-id=/new-docs/toolstack/responsibilities/index.html><a class=padding href=/new-docs/toolstack/responsibilities/index.html>Responsibilities</a></li><li data-nav-id=/new-docs/toolstack/high-level/index.html><input type=checkbox id=section-93d1c0b933c799c336ad0fd09a6dc0ae aria-controls=subsections-93d1c0b933c799c336ad0fd09a6dc0ae><label for=section-93d1c0b933c799c336ad0fd09a6dc0ae><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu High-level architecture</span></label><a class=padding href=/new-docs/toolstack/high-level/index.html>High-level architecture</a><ul id=subsections-93d1c0b933c799c336ad0fd09a6dc0ae class="morespace collapsible-menu"><li data-nav-id=/new-docs/toolstack/high-level/environment/index.html><a class=padding href=/new-docs/toolstack/high-level/environment/index.html>Environment</a></li><li data-nav-id=/new-docs/toolstack/high-level/daemons/index.html><a class=padding href=/new-docs/toolstack/high-level/daemons/index.html>Daemons</a></li><li data-nav-id=/new-docs/toolstack/high-level/interfaces/index.html><a class=padding href=/new-docs/toolstack/high-level/interfaces/index.html>Interfaces</a></li></ul></li><li data-nav-id=/new-docs/toolstack/features/index.html class=parent><input type=checkbox id=section-a202420b9d8f13c2d690377c4357de50 aria-controls=subsections-a202420b9d8f13c2d690377c4357de50 checked><label for=section-a202420b9d8f13c2d690377c4357de50><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Features</span></label><a class=padding href=/new-docs/toolstack/features/index.html>Features</a><ul id=subsections-a202420b9d8f13c2d690377c4357de50 class="morespace collapsible-menu"><li data-nav-id=/new-docs/toolstack/features/DR/index.html><a class=padding href=/new-docs/toolstack/features/DR/index.html>Disaster Recovery</a></li><li data-nav-id=/new-docs/toolstack/features/events/index.html class=active><a class=padding href=/new-docs/toolstack/features/events/index.html>Event handling</a></li><li data-nav-id=/new-docs/toolstack/features/HA/index.html><a class=padding href=/new-docs/toolstack/features/HA/index.html>High-Availability</a></li><li data-nav-id=/new-docs/toolstack/features/NUMA/index.html><a class=padding href=/new-docs/toolstack/features/NUMA/index.html>NUMA</a></li><li data-nav-id=/new-docs/toolstack/features/snapshots/index.html><a class=padding href=/new-docs/toolstack/features/snapshots/index.html>Snapshots</a></li><li data-nav-id=/new-docs/toolstack/features/VGPU/index.html><a class=padding href=/new-docs/toolstack/features/VGPU/index.html>vGPU</a></li><li data-nav-id=/new-docs/toolstack/features/XSM/index.html><a class=padding href=/new-docs/toolstack/features/XSM/index.html>Xapi Storage Migration</a></li></ul></li></ul></li><li data-nav-id=/new-docs/xapi/index.html><input type=checkbox id=section-38d9a208f329bfd7f57b7a3d82b1b09a aria-controls=subsections-38d9a208f329bfd7f57b7a3d82b1b09a><label for=section-38d9a208f329bfd7f57b7a3d82b1b09a><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Xapi</span></label><a class=padding href=/new-docs/xapi/index.html>Xapi</a><ul id=subsections-38d9a208f329bfd7f57b7a3d82b1b09a class="morespace collapsible-menu"><li data-nav-id=/new-docs/xapi/guides/index.html><input type=checkbox id=section-1e852a9c61356e39c38ffde6aaccdadf aria-controls=subsections-1e852a9c61356e39c38ffde6aaccdadf><label for=section-1e852a9c61356e39c38ffde6aaccdadf><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Guides</span></label><a class=padding href=/new-docs/xapi/guides/index.html>Guides</a><ul id=subsections-1e852a9c61356e39c38ffde6aaccdadf class="morespace collapsible-menu"><li data-nav-id=/new-docs/xapi/guides/howtos/index.html><input type=checkbox id=section-259bbbeab1560e4f0d61ad99041ab23f aria-controls=subsections-259bbbeab1560e4f0d61ad99041ab23f><label for=section-259bbbeab1560e4f0d61ad99041ab23f><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu How to add....</span></label><a class=padding href=/new-docs/xapi/guides/howtos/index.html>How to add....</a><ul id=subsections-259bbbeab1560e4f0d61ad99041ab23f class="morespace collapsible-menu"><li data-nav-id=/new-docs/xapi/guides/howtos/add-class/index.html><a class=padding href=/new-docs/xapi/guides/howtos/add-class/index.html>Adding a Class to the API</a></li><li data-nav-id=/new-docs/xapi/guides/howtos/add-field/index.html><a class=padding href=/new-docs/xapi/guides/howtos/add-field/index.html>Adding a field to the API</a></li><li data-nav-id=/new-docs/xapi/guides/howtos/add-function/index.html><a class=padding href=/new-docs/xapi/guides/howtos/add-function/index.html>Adding a function to the API</a></li><li data-nav-id=/new-docs/xapi/guides/howtos/add-api-extension/index.html><a class=padding href=/new-docs/xapi/guides/howtos/add-api-extension/index.html>Adding a XenAPI extension</a></li></ul></li></ul></li><li data-nav-id=/new-docs/xapi/database/index.html><input type=checkbox id=section-378fe6bda61dabebb37cf2433db26b2f aria-controls=subsections-378fe6bda61dabebb37cf2433db26b2f><label for=section-378fe6bda61dabebb37cf2433db26b2f><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Database</span></label><a class=padding href=/new-docs/xapi/database/index.html>Database</a><ul id=subsections-378fe6bda61dabebb37cf2433db26b2f class="morespace collapsible-menu"><li data-nav-id=/new-docs/xapi/database/redo-log/index.html><a class=padding href=/new-docs/xapi/database/redo-log/index.html>Metadata-on-LUN</a></li></ul></li><li data-nav-id=/new-docs/xapi/memory/index.html><a class=padding href=/new-docs/xapi/memory/index.html>Memory</a></li><li data-nav-id=/new-docs/xapi/walkthroughs/index.html><input type=checkbox id=section-9c43a1a521e6b0d3839462550f0172af aria-controls=subsections-9c43a1a521e6b0d3839462550f0172af><label for=section-9c43a1a521e6b0d3839462550f0172af><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Walk-throughs</span></label><a class=padding href=/new-docs/xapi/walkthroughs/index.html>Walk-throughs</a><ul id=subsections-9c43a1a521e6b0d3839462550f0172af class="morespace collapsible-menu"><li data-nav-id=/new-docs/xapi/walkthroughs/migration_overview/index.html><a class=padding href=/new-docs/xapi/walkthroughs/migration_overview/index.html>How XAPI handles migration request</a></li></ul></li><li data-nav-id=/new-docs/xapi/storage/index.html><input type=checkbox id=section-6bab529a669346ed9d1815ed30e48c91 aria-controls=subsections-6bab529a669346ed9d1815ed30e48c91><label for=section-6bab529a669346ed9d1815ed30e48c91><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Storage</span></label><a class=padding href=/new-docs/xapi/storage/index.html>Storage</a><ul id=subsections-6bab529a669346ed9d1815ed30e48c91 class="morespace collapsible-menu"><li data-nav-id=/new-docs/xapi/storage/sxm/index.html><a class=padding href=/new-docs/xapi/storage/sxm/index.html>Storage migration</a></li></ul></li><li data-nav-id=/new-docs/xapi/cli/index.html><a class=padding href=/new-docs/xapi/cli/index.html>CLI</a></li></ul></li><li data-nav-id=/new-docs/xenopsd/index.html><input type=checkbox id=section-c72fd23679970685706f8c9f1bb2fa52 aria-controls=subsections-c72fd23679970685706f8c9f1bb2fa52><label for=section-c72fd23679970685706f8c9f1bb2fa52><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Xenopsd</span></label><a class=padding href=/new-docs/xenopsd/index.html>Xenopsd</a><ul id=subsections-c72fd23679970685706f8c9f1bb2fa52 class="morespace collapsible-menu"><li data-nav-id=/new-docs/xenopsd/architecture/index.html><a class=padding href=/new-docs/xenopsd/architecture/index.html>Architecture</a></li><li data-nav-id=/new-docs/xenopsd/design/index.html><input type=checkbox id=section-9b92b6e8232f75e147c3792adf755e68 aria-controls=subsections-9b92b6e8232f75e147c3792adf755e68><label for=section-9b92b6e8232f75e147c3792adf755e68><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Design</span></label><a class=padding href=/new-docs/xenopsd/design/index.html>Design</a><ul id=subsections-9b92b6e8232f75e147c3792adf755e68 class="morespace collapsible-menu"><li data-nav-id=/new-docs/xenopsd/design/Events/index.html><a class=padding href=/new-docs/xenopsd/design/Events/index.html>Events</a></li><li data-nav-id=/new-docs/xenopsd/design/hooks/index.html><a class=padding href=/new-docs/xenopsd/design/hooks/index.html>Hooks</a></li><li data-nav-id=/new-docs/xenopsd/design/pvs-proxy-ovs/index.html><a class=padding href=/new-docs/xenopsd/design/pvs-proxy-ovs/index.html>PVS Proxy OVS Rules</a></li><li data-nav-id=/new-docs/xenopsd/design/suspend-image-considerations/index.html><a class=padding href=/new-docs/xenopsd/design/suspend-image-considerations/index.html>Requirements for suspend image framing</a></li><li data-nav-id=/new-docs/xenopsd/design/suspend-image-framing-format/index.html><a class=padding href=/new-docs/xenopsd/design/suspend-image-framing-format/index.html>Suspend image framing format</a></li><li data-nav-id=/new-docs/xenopsd/design/Tasks/index.html><a class=padding href=/new-docs/xenopsd/design/Tasks/index.html>Tasks</a></li></ul></li><li data-nav-id=/new-docs/xenopsd/features/index.html><a class=padding href=/new-docs/xenopsd/features/index.html>Features</a></li><li data-nav-id=/new-docs/xenopsd/walkthroughs/index.html><input type=checkbox id=section-523c4f88c9de72bf362da89f937681e6 aria-controls=subsections-523c4f88c9de72bf362da89f937681e6><label for=section-523c4f88c9de72bf362da89f937681e6><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Walk-throughs</span></label><a class=padding href=/new-docs/xenopsd/walkthroughs/index.html>Walk-throughs</a><ul id=subsections-523c4f88c9de72bf362da89f937681e6 class="morespace collapsible-menu"><li data-nav-id=/new-docs/xenopsd/walkthroughs/live-migration/index.html><a class=padding href=/new-docs/xenopsd/walkthroughs/live-migration/index.html>Live Migration</a></li><li data-nav-id=/new-docs/xenopsd/walkthroughs/VM.migrate/index.html><a class=padding href=/new-docs/xenopsd/walkthroughs/VM.migrate/index.html>Walkthrough: Migrating a VM</a></li><li data-nav-id=/new-docs/xenopsd/walkthroughs/VM.start/index.html><a class=padding href=/new-docs/xenopsd/walkthroughs/VM.start/index.html>Walkthrough: Starting a VM</a></li></ul></li></ul></li><li data-nav-id=/new-docs/xcp-networkd/index.html><a class=padding href=/new-docs/xcp-networkd/index.html>Networkd</a></li><li data-nav-id=/new-docs/squeezed/index.html><input type=checkbox id=section-1eeda4d753cc1773dfada70c3819a0a1 aria-controls=subsections-1eeda4d753cc1773dfada70c3819a0a1><label for=section-1eeda4d753cc1773dfada70c3819a0a1><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu Squeezed</span></label><a class=padding href=/new-docs/squeezed/index.html>Squeezed</a><ul id=subsections-1eeda4d753cc1773dfada70c3819a0a1 class="morespace collapsible-menu"><li data-nav-id=/new-docs/squeezed/architecture/index.html><a class=padding href=/new-docs/squeezed/architecture/index.html>Architecture</a></li><li data-nav-id=/new-docs/squeezed/design/index.html><a class=padding href=/new-docs/squeezed/design/index.html>Design</a></li></ul></li><li data-nav-id=/new-docs/xapi-guard/index.html><a class=padding href=/new-docs/xapi-guard/index.html>Xapi-guard</a></li><li data-nav-id=/new-docs/xcp-rrdd/index.html><input type=checkbox id=section-54ab6488aa1c00b15a58b0c7ace94c5e aria-controls=subsections-54ab6488aa1c00b15a58b0c7ace94c5e><label for=section-54ab6488aa1c00b15a58b0c7ace94c5e><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu RRDD</span></label><a class=padding href=/new-docs/xcp-rrdd/index.html>RRDD</a><ul id=subsections-54ab6488aa1c00b15a58b0c7ace94c5e class="morespace collapsible-menu"><li data-nav-id=/new-docs/xcp-rrdd/futures/archival-redesign/index.html><a class=padding href=/new-docs/xcp-rrdd/futures/archival-redesign/index.html>RRDD archival redesign</a></li><li data-nav-id=/new-docs/xcp-rrdd/design/plugin-protocol-v2/index.html><a class=padding href=/new-docs/xcp-rrdd/design/plugin-protocol-v2/index.html>RRDD plugin protocol v2</a></li><li data-nav-id=/new-docs/xcp-rrdd/futures/sr-level-rrds/index.html><a class=padding href=/new-docs/xcp-rrdd/futures/sr-level-rrds/index.html>SR-Level RRDs</a></li></ul></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter"></div><div id=menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=select-language>Language</label>
<select id=select-language onchange="location=baseUri+this.value"></select></div><div class=clear></div></div></li><li id=select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=select-variant>Theme</label>
<select id=select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=red value=red selected>Red</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><div class="padding menu-control"><i class="fas fa-history fa-fw"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=footer class=footerFooter></div></div></div></aside><script src=/new-docs/js/clipboard.min.js?1711635954 defer></script>
<script src=/new-docs/js/perfect-scrollbar.min.js?1711635954 defer></script>
<script src=/new-docs/js/theme.js?1711635954 defer></script></body></html>