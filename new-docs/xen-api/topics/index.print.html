<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.127.0"><meta name=generator content="Relearn 7.3.2"><meta name=description content="API for configuring the udhcp server in Dom0 Guest agents Memory Metrics Snapshots VM consoles VM import/export VM Lifecycle XenCenter"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Topics :: XAPI Toolstack Developer Documentation"><meta name=twitter:description content="API for configuring the udhcp server in Dom0 Guest agents Memory Metrics Snapshots VM consoles VM import/export VM Lifecycle XenCenter"><meta property="og:url" content="https://xapi-project.github.io/new-docs/xen-api/topics/index.html"><meta property="og:site_name" content="XAPI Toolstack Developer Documentation"><meta property="og:title" content="Topics :: XAPI Toolstack Developer Documentation"><meta property="og:description" content="API for configuring the udhcp server in Dom0 Guest agents Memory Metrics Snapshots VM consoles VM import/export VM Lifecycle XenCenter"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Topics :: XAPI Toolstack Developer Documentation"><meta itemprop=description content="API for configuring the udhcp server in Dom0 Guest agents Memory Metrics Snapshots VM consoles VM import/export VM Lifecycle XenCenter"><meta itemprop=wordCount content="20"><title>Topics :: XAPI Toolstack Developer Documentation</title>
<link href=https://xapi-project.github.io/new-docs/xen-api/topics/index.html rel=canonical type=text/html title="Topics :: XAPI Toolstack Developer Documentation"><link href=/new-docs/xen-api/topics/index.xml rel=alternate type=application/rss+xml title="Topics :: XAPI Toolstack Developer Documentation"><link href=/new-docs/images/favicon.png?1746630433 rel=icon type=image/png><link href=/new-docs/css/fontawesome-all.min.css?1746630433 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/new-docs/css/fontawesome-all.min.css?1746630433 rel=stylesheet></noscript><link href=/new-docs/css/auto-complete.css?1746630433 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/new-docs/css/auto-complete.css?1746630433 rel=stylesheet></noscript><link href=/new-docs/css/perfect-scrollbar.min.css?1746630433 rel=stylesheet><link href=/new-docs/css/theme.min.css?1746630433 rel=stylesheet><link href=/new-docs/css/format-print.min.css?1746630433 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://xapi-project.github.io/new-docs",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["auto","zen-light","zen-dark","red","blue","green","learn","neon","relearn-light","relearn-bright","relearn-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link rel=stylesheet href=https://xapi-project.github.io/new-docs/css/misc.css></head><body class="mobile-support print" data-url=/new-docs/xen-api/topics/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/new-docs/index.html><span itemprop=name>XAPI Toolstack Developer Guide</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/new-docs/xen-api/index.html><span itemprop=name>XenAPI</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Topics</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-edit" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=https://github.com/xapi-project/xen-api/edit/master/doc/content/xen-api/topics/_index.md target=_blank title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a></div><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/new-docs/xen-api/topics/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/new-docs/xen-api/releases/rio/index.html title="XenServer 4.0 (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/new-docs/xen-api/topics/udhcp/index.html title="API for configuring the udhcp server in Dom0 (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable xen-api" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=topics>Topics</h1><ul class="children children-li children-sort-"><li><a href=/new-docs/xen-api/topics/udhcp/index.html>API for configuring the udhcp server in Dom0</a></li><li><a href=/new-docs/xen-api/topics/guest-agents/index.html>Guest agents</a></li><li><a href=/new-docs/xen-api/topics/memory/index.html>Memory</a></li><li><a href=/new-docs/xen-api/topics/metrics/index.html>Metrics</a></li><li><a href=/new-docs/xen-api/topics/snapshots/index.html>Snapshots</a></li><li><a href=/new-docs/xen-api/topics/consoles/index.html>VM consoles</a></li><li><a href=/new-docs/xen-api/topics/importexport/index.html>VM import/export</a></li><li><a href=/new-docs/xen-api/topics/vm-lifecycle/index.html>VM Lifecycle</a></li><li><a href=/new-docs/xen-api/topics/xencenter/index.html>XenCenter</a></li></ul><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Topics</h1><article class=default><header class=headline></header><h1 id=api-for-configuring-the-udhcp-server-in-dom0>API for configuring the udhcp server in Dom0</h1><p>This API allows you to configure the DHCP service running on the Host
Internal Management Network (HIMN). The API configures a udhcp daemon
residing in Dom0 and alters the service configuration for any VM using
the network.</p><p>It should be noted that for this reason, that callers who modify the
default configuration should be aware that their changes may have an
adverse effect on other consumers of the HIMN.</p><h2 id=version-history>Version history</h2><pre><code>Date        State
----        ----
2013-3-15   Stable
</code></pre><p><em>Stable</em>: this API is considered stable and unlikely to change between
software version and between hotfixes.</p><h2 id=api-description>API description</h2><p>The API for configuring the network is based on a series of other_config
keys that can be set by the caller on the HIMN XAPI network object. Once
any of the keys below have been set, the caller must ensure that any VIFs
attached to the HIMN are removed, destroyed, created and plugged.</p><pre><code>ip_begin
</code></pre><p>The first IP address in the desired subnet that the caller wishes the
DHCP service to use.</p><pre><code>ip_end
</code></pre><p>The last IP address in the desired subnet that the caller wishes the
DHCP service to use.</p><pre><code>netmask
</code></pre><p>The subnet mask for each of the issues IP addresses.</p><pre><code>ip_disable_gw
</code></pre><p>A boolean key for disabling the DHCP server from returning a default
gateway for VMs on the network. To disable returning the gateway address
set the key to True.</p><p><em>Note</em>: By default, the DHCP server will issue a default gateway for
those requesting an address. Setting this key may disrupt applications
that require the default gateway for communicating with Dom0 and so
should be used with care.</p><h2 id=example-code>Example code</h2><p>An example python extract of setting the config for the network:</p><pre><code>def get_himn_ref():
    networks = session.xenapi.network.get_all_records()
    for ref, rec in networks.iteritems():
        if 'is_host_internal_management_network' \
                                        in rec['other_config']:                                            
            return ref

    raise Exception(&quot;Error: unable to find HIMN.&quot;)


himn_ref = get_himn_ref()
other_config = session.xenapi.network.get_other_config(himn_ref)

other_config['ip_begin'] = &quot;169.254.0.1&quot;
other_config['ip_end'] = &quot;169.254.255.254&quot;
other_config['netmask'] = &quot;255.255.0.0&quot;

session.xenapi.network.set_other_config(himn_ref, other_config)
</code></pre><p>An example for how to disable the server returning a default gateway:</p><pre><code>himn_ref = get_himn_ref()
other_config = session.xenapi.network.get_other_config(himn_ref)

other_config['ip_disable_gw'] = True

session.xenapi.network.set_other_config(himn_ref, other_config)
</code></pre><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=guest-agents>Guest agents</h1><p>&ldquo;Guest agents&rdquo; are special programs which run inside VMs which can be controlled
via the XenAPI.</p><p>One communication method between XenAPI clients is via Xenstore.</p><h2 id=adding-xenstore-entries-to-vms>Adding Xenstore entries to VMs</h2><p>Developers may wish to install guest agents into VMs which take special action based on the type of the VM. In order to communicate this information into the guest, a special Xenstore name-space known as <code>vm-data</code> is available which is populated at VM creation time. It is populated from the <code>xenstore-data</code> map in the VM record.</p><p>Set the <code>xenstore-data</code> parameter in the VM record:</p><pre><code>xe vm-param-set uuid= xenstore-data:vm-data/foo=bar
</code></pre><p>Start the VM.</p><p>If it is a Linux-based VM, install the COMPANY_TOOLS and use the <code>xenstore-read</code> to verify that the node exists in Xenstore.</p><blockquote><p><strong>Note</strong></p><p>Only prefixes beginning with <code>vm-data</code> are permitted, and anything not in this name-space will be silently ignored when starting the VM.</p></blockquote><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=memory>Memory</h1><p>Memory is used for many things:</p><ul><li>the hypervisor code: this is the Xen executable itself</li><li>the hypervisor heap: this is needed for per-domain structures and per-vCPU
structures</li><li>the crash kernel: this is needed to collect information after a host crash</li><li>domain RAM: this is the memory the VM believes it has</li><li>shadow memory: for HVM guests running on hosts without hardware assisted
paging (HAP) Xen uses shadow to optimise page table updates. For all guests
shadow is used during live migration for tracking the memory transfer.</li><li>video RAM for the virtual graphics card</li></ul><p>Some of these are constants (e.g. hypervisor code) while some depend on the VM
configuration (e.g. domain RAM). Xapi calls the constants &ldquo;host overhead&rdquo; and
the variables due to VM configuration as &ldquo;VM overhead&rdquo;.
These overheads are subtracted from free memory on the host when starting,
resuming and migrating VMs.</p><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=metrics>Metrics</h1><p><a href=https://github.com/xapi-project/xen-api/ocaml/xcp-rrdd rel=external target=_blank>xcp-rrdd</a>
records statistics about the host and the VMs running on top.
The metrics are stored persistently for long-term access and analysis of
historical trends.
Statistics are stored in <a href=http://oss.oetiker.ch/rrdtool/ rel=external target=_blank>RRDs</a> (Round Robin
Databases).
RRDs are fixed-size structures that store time series with decreasing time
resolution: the older the data point is, the longer the timespan it represents.
&lsquo;Data sources&rsquo; are sampled every few seconds and points are added to
the highest resolution RRD. Periodically each high-frequency RRD is
&lsquo;consolidated&rsquo; (e.g. averaged) to produce a data point for a lower-frequency
RRD.</p><p>RRDs are resident on the host on which the VM is running, or the pool
coordinator when the VM is not running.
The RRDs are backed up every day.</p><h2 id=granularity>Granularity</h2><p>Statistics are persisted for a maximum of one year, and are stored at
different granularities.
The average and most recent values are stored at intervals of:</p><ul><li>five seconds for the past ten minutes</li><li>one minute for the past two hours</li><li>one hour for the past week</li><li>one day for the past year</li></ul><p>RRDs are saved to disk as uncompressed XML. The size of each RRD when
written to disk ranges from 200KiB to approximately 1.2MiB when the RRD
stores the full year of statistics.</p><p>By default each RRD contains only averaged data to save storage space.
To record minimum and maximum values in future RRDs, set the Pool-wide flag</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>xe pool-param-set uuid<span style=color:#f92672>=</span> other-config:create_min_max_in_new_VM_RRDs<span style=color:#f92672>=</span>true</span></span></code></pre></div><h1 id=downloading>Downloading</h1><p>Statistics can be downloaded over HTTP in XML or JSON format, for example
using <code>wget</code>.
See <a href=http://oss.oetiker.ch/rrdtool/doc/rrddump.en.html rel=external target=_blank>rrddump</a> and
<a href=http://oss.oetiker.ch/rrdtool/doc/rrdxport.en.html rel=external target=_blank>rrdxport</a> for information
about the XML format.
The JSON format has the same structure as the XML.
Parameters are appended to the URL following a question mark (?) and separated
by ampersands (&).
HTTP authentication can take the form of a username and password or a session
token in a URL parameter.</p><p>Statistics may be downloaded all at once, including all history, or as
deltas suitable for interactive graphing.</p><h2 id=downloading-statistics-all-at-once>Downloading statistics all at once</h2><p>To obtain a full dump of RRD data for a host use:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget  http://hostname/host_rrd?session_id<span style=color:#f92672>=</span>OpaqueRef:43df3204-9360-c6ab-923e-41a8d19389ba<span style=color:#e6db74>&#34;</span></span></span></code></pre></div><p>where the session token has been fetched from the server using the API.</p><p>For example, using Python&rsquo;s <a href=https://pypi.org/project/XenAPI/ rel=external target=_blank>XenAPI</a> library:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> XenAPI
</span></span><span style=display:flex><span>username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;root&#34;</span>
</span></span><span style=display:flex><span>password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;actual_password&#34;</span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://hostname&#34;</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> XenAPI<span style=color:#f92672>.</span>Session(url)
</span></span><span style=display:flex><span>session<span style=color:#f92672>.</span>xenapi<span style=color:#f92672>.</span>login_with_password(username, password, <span style=color:#e6db74>&#34;1.0&#34;</span>, <span style=color:#e6db74>&#34;session_getter&#34;</span>)
</span></span><span style=display:flex><span>session<span style=color:#f92672>.</span>_session</span></span></code></pre></div><p>A URL parameter is used to decide which format to return: XML is returned by
default, adding the parameter <code>json</code> makes the server return JSON.
Starting from xapi version 23.17.0, the server uses the HTTP header <code>Accept</code>
to decide which format to return.
When both formats are accepted, for example, using <code>*/*</code>; JSON is returned.
Of interest are the clients wget and curl which use this accept header value,
meaning that when using them the default behaviour will change and the accept
header needs to be overridden to make the server return XML.
The content type is provided in the reponse&rsquo;s headers in these newer versions.</p><p>The XML RRD data is in the format used by rrdtool and looks like this:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;rrd&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;version&gt;</span>0003<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;step&gt;</span>5<span style=color:#f92672>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;lastupdate&gt;</span>1213616574<span style=color:#f92672>&lt;/lastupdate&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;ds&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;name&gt;</span>memory_total_kib<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;type&gt;</span>GAUGE<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;minimal_heartbeat&gt;</span>300.0000<span style=color:#f92672>&lt;/minimal_heartbeat&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;min&gt;</span>0.0<span style=color:#f92672>&lt;/min&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;max&gt;</span>Infinity<span style=color:#f92672>&lt;/max&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;last_ds&gt;</span>2070172<span style=color:#f92672>&lt;/last_ds&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;value&gt;</span>9631315.6300<span style=color:#f92672>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;unknown_sec&gt;</span>0<span style=color:#f92672>&lt;/unknown_sec&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/ds&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;ds&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>&lt;!-- other dss - the order of the data sources is important
</span></span></span><span style=display:flex><span><span style=color:#75715e>        and defines the ordering of the columns in the archives below --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/ds&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;rra&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;cf&gt;</span>AVERAGE<span style=color:#f92672>&lt;/cf&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;pdp_per_row&gt;</span>1<span style=color:#f92672>&lt;/pdp_per_row&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;params&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;xff&gt;</span>0.5000<span style=color:#f92672>&lt;/xff&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/params&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;cdp_prep&gt;</span> <span style=color:#75715e>&lt;!-- This is for internal use --&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;ds&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;primary_value&gt;</span>0.0<span style=color:#f92672>&lt;/primary_value&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;secondary_value&gt;</span>0.0<span style=color:#f92672>&lt;/secondary_value&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;value&gt;</span>0.0<span style=color:#f92672>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;unknown_datapoints&gt;</span>0<span style=color:#f92672>&lt;/unknown_datapoints&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/ds&gt;</span>
</span></span><span style=display:flex><span>      ...other dss - internal use only...
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/cdp_prep&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;database&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;row&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>2070172.0000<span style=color:#f92672>&lt;/v&gt;</span>  <span style=color:#75715e>&lt;!-- columns correspond to the DSs defined above --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>1756408.0000<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>732.2130<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>782.9186<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>647.0431<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0001<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0268<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0100<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;v&gt;</span>615.1072<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;/row&gt;</span>
</span></span><span style=display:flex><span>     ...
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/rra&gt;</span>
</span></span><span style=display:flex><span>  ... other archives ...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/rrd&gt;</span></span></span></code></pre></div><p>To obtain a full dump of RRD data of a VM with uuid <code>x</code>:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget <span style=color:#e6db74>&#34;http://hostname/vm_rrd?session_id=&lt;token&gt;&amp;uuid=x&#34;</span></span></span></code></pre></div><p>Note that it is quite expensive to download full RRDs as they contain
lots of historical information. For interactive displays clients should
download deltas instead.</p><h2 id=downloading-deltas>Downloading deltas</h2><p>To obtain an update of all VM statistics on a host, the URL would be of
the form:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget <span style=color:#e6db74>&#34;https://hostname/rrd_updates?session_id=&lt;token&gt;&amp;start=&lt;secondsinceepoch&gt;&#34;</span></span></span></code></pre></div><p>This request returns data in an rrdtool <code>xport</code> style XML format, for every VM
resident on the particular host that is being queried.
To differentiate which column in the export is associated with which VM, the
<code>legend</code> field is prefixed with the UUID of the VM.</p><p>An example <code>rrd_updates</code> output:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;xport&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;meta&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;start&gt;</span>1213578000<span style=color:#f92672>&lt;/start&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;step&gt;</span>3600<span style=color:#f92672>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;end&gt;</span>1213617600<span style=color:#f92672>&lt;/end&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;rows&gt;</span>12<span style=color:#f92672>&lt;/rows&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;columns&gt;</span>12<span style=color:#f92672>&lt;/columns&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;legend&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>AVERAGE:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu1<span style=color:#f92672>&lt;/entry&gt;</span> <span style=color:#75715e>&lt;!-- nb - each data source might have multiple entries for different consolidation functions --&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>AVERAGE:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu0<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>AVERAGE:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:memory<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>MIN:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu1<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>MIN:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu0<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>MIN:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:memory<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>MAX:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu1<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>MAX:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu0<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>MAX:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:memory<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>LAST:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu1<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>LAST:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:cpu0<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;entry&gt;</span>LAST:vm:ecd8d7a0-1be3-4d91-bd0e-4888c0e30ab3:memory<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/legend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/meta&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;data&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;row&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;t&gt;</span>1213617600<span style=color:#f92672>&lt;/t&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span> <span style=color:#75715e>&lt;!-- once again, the order or the columns is defined by the legend above --&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0282<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>209715200.0000<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0201<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>209715200.0000<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0445<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>209715200.0000<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>0.0243<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;v&gt;</span>209715200.0000<span style=color:#f92672>&lt;/v&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/row&gt;</span>
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/data&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/xport&gt;</span></span></span></code></pre></div><p>To obtain host updates too, use the query parameter <code>host=true</code>:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget <span style=color:#e6db74>&#34;http://hostname/rrd_updates?session_id=&lt;token&gt;&amp;start=&lt;secondssinceepoch&gt;&amp;host=true&#34;</span></span></span></code></pre></div><p>The step will decrease as the period decreases, which means that if you
request statistics for a shorter time period you will get more detailed
statistics.</p><p>To download updates containing only the averages, or minimums or maximums,
add the parameter <code>cf=AVERAGE|MIN|MAX</code> (note case is important) e.g.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget <span style=color:#e6db74>&#34;http://hostname/rrd_updates?session_id=&lt;token&gt;&amp;start=0&amp;cf=MAX&#34;</span></span></span></code></pre></div><p>To request a different update interval, add the parameter <code>interval=seconds</code> e.g.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget <span style=color:#e6db74>&#34;http://hostname/rrd_updates?session_id=&lt;token&gt;&amp;start=0&amp;interval=5&#34;</span></span></span></code></pre></div><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=snapshots>Snapshots</h1><p>Snapshots represent the state of a VM, or a disk (VDI) at a point in time.
They can be used for:</p><ul><li>backups (hourly, daily, weekly etc)</li><li>experiments (take snapshot, try something, revert back again)</li><li>golden images (install OS, get it just right, clone it 1000s of times)</li></ul><p>Read more about <a href=/new-docs/toolstack/features/snapshots/index.html>Snapshots: the High-Level Feature</a>.</p><h1 id=taking-a-vdi-snapshot>Taking a VDI snapshot</h1><p>To take a snapshot of a single disk (VDI):</p><div class="highlight wrap-code"><pre tabindex=0><code>snapshot_vdi &lt;- VDI.snapshot(session_id, vdi, driver_params)</code></pre></div><p>where <code>vdi</code> is the reference to the disk to be snapshotted, and <code>driver_params</code>
is a list of string pairs providing optional backend implementation-specific hints.
The snapshot operation should be quick (i.e. it should never be implemented as
a slow disk copy) and the resulting VDI will have</p><table><thead><tr><th>Field name</th><th>Description</th></tr></thead><tbody><tr><td>is_a_snapshot</td><td>a flag, set to true, indicating the disk is a snapshot</td></tr><tr><td>snapshot_of</td><td>a reference to the disk the snapshot was created from</td></tr><tr><td>snapshot_time</td><td>the time the snapshot was taken</td></tr></tbody></table><p>The resulting snapshot should be considered read-only. Depending on the backend
implementation it may be technically possible to write to the snapshot, but clients
must not do this. To create a writable disk from a snapshot, see &ldquo;restoring from
a snapshot&rdquo; below.</p><p>Note that the storage backend is free to implement this in different ways. We
do not assume the presence of a .vhd-formatted storage repository. Clients
must never assume anything about the backend implementation without checking
first with the maintainers of the backend implementation.</p><h1 id=restoring-to-a-vdi-snapshot>Restoring to a VDI snapshot</h1><p>To restore from a VDI snapshot first</p><div class="highlight wrap-code"><pre tabindex=0><code>new_vdi &lt;- VDI.clone(session_id, snapshot_vdi, driver_params)</code></pre></div><p>where <code>snapshot_vdi</code> is a reference to the snapshot VDI, and <code>driver_params</code>
is a list of string pairs providing optional backend implementation-specific hints.
The clone operation should be quick (i.e. it should never be implemented as
a slow disk copy) and the resulting VDI will have</p><table><thead><tr><th>Field name</th><th>Description</th></tr></thead><tbody><tr><td>is_a_snapshot</td><td>a flag, set to false, indicating the disk is not a snapshot</td></tr><tr><td>snapshot_of</td><td>an invalid reference</td></tr><tr><td>snapshot_time</td><td>an invalid time</td></tr></tbody></table><p>The resulting disk is writable and can be used by the client as normal.</p><p>Note that the &ldquo;restored&rdquo; VDI will have a different <code>VDI.uuid</code> and reference to
the original VDI.</p><h1 id=taking-a-vm-snapshot>Taking a VM snapshot</h1><p>A VM snapshot is a copy of the VM metadata and a snapshot of all the associated
VDIs at around the same point in time. To take a VM snapshot:</p><div class="highlight wrap-code"><pre tabindex=0><code>snapshot_vm &lt;- VM.snapshot(session_id, vm, new_name)</code></pre></div><p>where <code>vm</code> is a reference to the existing VM and <code>new_name</code> will be the <code>name_label</code>
of the resulting VM (snapshot) object. The resulting VM will have</p><table><thead><tr><th>Field name</th><th>Description</th></tr></thead><tbody><tr><td>is_a_snapshot</td><td>a flag, set to true, indicating the VM is a snapshot</td></tr><tr><td>snapshot_of</td><td>a reference to the VM the snapshot was created from</td></tr><tr><td>snapshot_time</td><td>the time the snapshot was taken</td></tr></tbody></table><p>Note that each disk is snapshotted one-by-one and not at the same time.</p><h1 id=restoring-to-a-vm-snapshot>Restoring to a VM snapshot</h1><p>A VM snapshot can be reverted to a snapshot using</p><div class="highlight wrap-code"><pre tabindex=0><code>VM.revert(session_id, snapshot_ref)</code></pre></div><p>where <code>snapshot_ref</code> is a reference to the snapshot VM. Each VDI associated with
the VM before the snapshot will be destroyed and each VDI associated with the
snapshot will be cloned (see &ldquo;Reverting to a disk snapshot&rdquo; above) and associated
with the VM. The resulting VM will have</p><table><thead><tr><th>Field name</th><th>Description</th></tr></thead><tbody><tr><td>is_a_snapshot</td><td>a flag, set to false, indicating the VM is not a snapshot</td></tr><tr><td>snapshot_of</td><td>an invalid reference</td></tr><tr><td>snapshot_time</td><td>an invalid time</td></tr></tbody></table><p>Note that the <code>VM.uuid</code> and reference are preserved, but the <code>VDI.uuid</code> and
VDI references are not.</p><h1 id=downloading-a-disk-or-snapshot>Downloading a disk or snapshot</h1><p>Disks can be downloaded in either raw or vhd format using an HTTP 1.0 GET
request as follows:</p><div class="highlight wrap-code"><pre tabindex=0><code>GET /export_raw_vdi?session_id=%s&amp;task_id=%s&amp;vdi=%s&amp;format=%s[&amp;base=%s] HTTP/1.0\r\n
Connection: close\r\n
\r\n
\r\n</code></pre></div><p>where</p><ul><li><code>session_id</code> is a currently logged-in session</li><li><code>task_id</code> is a <code>Task</code> reference which will be used to monitor the
progress of this task and receive errors from it</li><li><code>vdi</code> is the reference of the <code>VDI</code> into which the data will be
imported</li><li><code>format</code> is either <code>vhd</code> or <code>raw</code></li><li>(optional) <code>base</code> is the reference of a <code>VDI</code> which has already been
exported and this export should only contain the blocks which have changed
since then.</li></ul><p>Note that the vhd format allows the disk to be sparse i.e. only contain allocated
blocks. This helps reduce the size of the download.</p><p>The xapi-project/xen-api repo has a
<a href=https://github.com/xapi-project/xen-api/blob/19afd3dfe8883814e525ce7ce39c8c959ce3c924/scripts/examples/python/exportimport.py#L32 rel=external target=_blank>python download example</a></p><h1 id=uploading-a-disk-or-snapshot>Uploading a disk or snapshot</h1><p>Disks can be uploaded in either raw or vhd format using an HTTP 1.0 PUT
request as follows:</p><div class="highlight wrap-code"><pre tabindex=0><code>PUT /import_raw_vdi?session_id=%s&amp;task_id=%s&amp;vdi=%s&amp;format=%s HTTP/1.0\r\n
Connection: close\r\n
\r\n
\r\n</code></pre></div><p>where</p><ul><li><code>session_id</code> is a currently logged-in session</li><li><code>task_id</code> is a <code>Task</code> reference which will be used to monitor the
progress of this task and receive errors from it</li><li><code>vdi</code> is the reference of the <code>VDI</code> into which the data will be
imported</li><li><code>format</code> is either <code>vhd</code> or <code>raw</code></li></ul><p>Note that you must create the disk (with the correct size) before importing
data to it. The disk doesn&rsquo;t have to be empty, in fact if restoring from a
series of incremental downloads it makes sense to upload them all to the
same disk in order.</p><h1 id=example-incremental-backup-with-xe>Example: incremental backup with xe</h1><p>This section will show how easy it is to build an incremental backup
tool using these APIs. For simplicity we will use the <code>xe</code> commands
rather than raw XMLRPC and HTTP.</p><p>For a VDI with uuid $VDI, take a snapshot:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>FULL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>xe vdi-snapshot uuid<span style=color:#f92672>=</span>$VDI<span style=color:#66d9ef>)</span></span></span></code></pre></div><p>Next perform a full backup into a file &ldquo;full.vhd&rdquo;, in vhd format:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>xe vdi-export uuid<span style=color:#f92672>=</span>$FULL filename<span style=color:#f92672>=</span>full.vhd format<span style=color:#f92672>=</span>vhd  --progress</span></span></code></pre></div><p>If the SR was using the vhd format internally (this is the default)
then the full backup will be sparse and will only contain blocks if they
have been written to.</p><p>After some time has passed and the VDI has been written to, take another
snapshot:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>DELTA<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>xe vdi-snapshot uuid<span style=color:#f92672>=</span>$VDI<span style=color:#66d9ef>)</span></span></span></code></pre></div><p>Now we can backup only the disk blocks which have changed between the original
snapshot $FULL and the next snapshot $DELTA into a file called &ldquo;delta.vhd&rdquo;:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>xe vdi-export uuid<span style=color:#f92672>=</span>$DELTA filename<span style=color:#f92672>=</span>delta.vhd format<span style=color:#f92672>=</span>vhd base<span style=color:#f92672>=</span>$FULL --progress</span></span></code></pre></div><p>We now have 2 files on the local system:</p><ul><li>&ldquo;full.vhd&rdquo;: a complete backup of the first snapshot</li><li>&ldquo;delta.vhd&rdquo;: an incremental backup of the second snapshot, relative to
the first</li></ul><p>For example:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>test $ ls -lh *.vhd
</span></span><span style=display:flex><span>-rw------- <span style=color:#ae81ff>1</span> dscott xendev 213M Aug <span style=color:#ae81ff>15</span> 10:39 delta.vhd
</span></span><span style=display:flex><span>-rw------- <span style=color:#ae81ff>1</span> dscott xendev 8.0G Aug <span style=color:#ae81ff>15</span> 10:39 full.vhd</span></span></code></pre></div><p>To restore the original snapshot you must create an empty disk with the
correct size. To find the size of a .vhd file use <code>qemu-img</code> as follows:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>test $ qemu-img info delta.vhd
</span></span><span style=display:flex><span>image: delta.vhd
</span></span><span style=display:flex><span>file format: vpc
</span></span><span style=display:flex><span>virtual size: 24G <span style=color:#f92672>(</span><span style=color:#ae81ff>25769705472</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>disk size: 212M</span></span></code></pre></div><p>Here the size is 25769705472 bytes.
Create a fresh VDI in SR $SR to restore the backup as follows:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>SIZE<span style=color:#f92672>=</span><span style=color:#ae81ff>25769705472</span>
</span></span><span style=display:flex><span>RESTORE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>xe vdi-create name-label<span style=color:#f92672>=</span>restored virtual-size<span style=color:#f92672>=</span>$SIZE sr-uuid<span style=color:#f92672>=</span>$SR type<span style=color:#f92672>=</span>user<span style=color:#66d9ef>)</span></span></span></code></pre></div><p>then import &ldquo;full.vhd&rdquo; into it:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>xe vdi-import uuid<span style=color:#f92672>=</span>$RESTORE filename<span style=color:#f92672>=</span>full.vhd format<span style=color:#f92672>=</span>vhd --progress</span></span></code></pre></div><p>Once &ldquo;full.vhd&rdquo; has been imported, the incremental backup can be restored
on top:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>xe vdi-import uuid<span style=color:#f92672>=</span>$RESTORE filename<span style=color:#f92672>=</span>delta.vhd format<span style=color:#f92672>=</span>vhd --progress</span></span></code></pre></div><p>Note there is no need to supply a &ldquo;base&rdquo; parameter when importing; Xapi will
treat the &ldquo;vhd differencing disk&rdquo; as a set of blocks and import them. It
is up to you to check you are importing them to the right place.</p><p>Now the VDI $RESTORE should have the same contents as $DELTA.</p><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=vm-consoles>VM consoles</h1><p>Most XenAPI graphical interfaces will want to gain access to the VM consoles, in order to render them to the user as if they were physical machines. There are several types of consoles available, depending on the type of guest or if the physical host console is being accessed:</p><h1 id=types-of-consoles>Types of consoles</h1><table><thead><tr><th style=text-align:left>Operating System</th><th style=text-align:left>Text</th><th style=text-align:left>Graphical</th><th style=text-align:left>Optimized graphical</th></tr></thead><tbody><tr><td style=text-align:left>Windows</td><td style=text-align:left>No</td><td style=text-align:left>VNC, using an API call</td><td style=text-align:left>RDP, directly from guest</td></tr><tr><td style=text-align:left>Linux</td><td style=text-align:left>Yes, through VNC and an API call</td><td style=text-align:left>No</td><td style=text-align:left>VNC, directly from guest</td></tr><tr><td style=text-align:left>Physical Host</td><td style=text-align:left>Yes, through VNC and an API call</td><td style=text-align:left>No</td><td style=text-align:left>No</td></tr></tbody></table><p>Hardware-assisted VMs, such as Windows, directly provide a graphical console over VNC. There is no text-based console, and guest networking is not necessary to use the graphical console. Once guest networking has been established, it is more efficient to setup Remote Desktop Access and use an RDP client to connect directly (this must be done outside of the XenAPI).</p><p>Paravirtual VMs, such as Linux guests, provide a native text console directly. XenServer provides a utility (called <code>vncterm</code>) to convert this text-based console into a graphical VNC representation. Guest networking is not necessary for this console to function. As with Windows above, Linux distributions often configure VNC within the guest, and directly connect to it over a guest network interface.</p><p>The physical host console is only available as a <code>vt100</code> console, which is exposed through the XenAPI as a VNC console by using <code>vncterm</code> in the control domain.</p><p>RFB (Remote Framebuffer) is the protocol which underlies VNC, specified in <a href=http://www.realvnc.com/docs/rfbproto.pdf rel=external target=_blank>The RFB Protocol</a>. Third-party developers are expected to provide their own VNC viewers, and many freely available implementations can be adapted for this purpose. RFB 3.3 is the minimum version which viewers must support.</p><h1 id=retrieving-vnc-consoles-using-the-api>Retrieving VNC consoles using the API</h1><p>VNC consoles are retrieved using a special URL passed through to the host agent. The sequence of API calls is as follows:</p><ol><li><p>Client to Master/443: XML-RPC: <code>Session.login_with_password()</code>.</p></li><li><p>Master/443 to Client: Returns a session reference to be used with subsequent calls.</p></li><li><p>Client to Master/443: XML-RPC: <code>VM.get_by_name_label()</code>.</p></li><li><p>Master/443 to Client: Returns a reference to a particular VM (or the &ldquo;control domain&rdquo; if you want to retrieve the physical host console).</p></li><li><p>Client to Master/443: XML-RPC: <code>VM.get_consoles()</code>.</p></li><li><p>Master/443 to Client: Returns a list of console objects associated with the VM.</p></li><li><p>Client to Master/443: XML-RPC: <code>VM.get_location()</code>.</p></li><li><p>Returns a URI describing where the requested console is located. The URIs are of the form: <code>https://192.168.0.1/console?ref=OpaqueRef:c038533a-af99-a0ff-9095-c1159f2dc6a0</code>.</p></li><li><p>Client to 192.168.0.1: HTTP CONNECT &ldquo;/console?ref=(&mldr;)&rdquo;</p></li></ol><p>The final HTTP CONNECT is slightly non-standard since the HTTP/1.1 RFC specifies that it should only be a host and a port, rather than a URL. Once the HTTP connect is complete, the connection can subsequently directly be used as a VNC server without any further HTTP protocol action.</p><p>This scheme requires direct access from the client to the control domain&rsquo;s IP, and will not work correctly if there are Network Address Translation (NAT) devices blocking such connectivity. You can use the CLI to retrieve the console URI from the client and perform a connectivity check.</p><p>Retrieve the VM UUID by running:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ VM<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>xe vm-list params<span style=color:#f92672>=</span>uuid --minimal name-label<span style=color:#f92672>=</span>&lt;name&gt;<span style=color:#66d9ef>)</span></span></span></code></pre></div><p>Retrieve the console information:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ xe console-list vm-uuid<span style=color:#f92672>=</span>$VM
</span></span><span style=display:flex><span>uuid <span style=color:#f92672>(</span> RO<span style=color:#f92672>)</span>             : 8013b937-ff7e-60d1-ecd8-e52d66c5879e
</span></span><span style=display:flex><span>          vm-uuid <span style=color:#f92672>(</span> RO<span style=color:#f92672>)</span>: 2d7c558a-8f03-b1d0-e813-cbe7adfa534c
</span></span><span style=display:flex><span>    vm-name-label <span style=color:#f92672>(</span> RO<span style=color:#f92672>)</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>         protocol <span style=color:#f92672>(</span> RO<span style=color:#f92672>)</span>: RFB
</span></span><span style=display:flex><span>         location <span style=color:#f92672>(</span> RO<span style=color:#f92672>)</span>: https://10.80.228.30/console?uuid<span style=color:#f92672>=</span>8013b937-ff7e-60d1-ecd8-e52d66c5879e</span></span></code></pre></div><p>Use command-line utilities like <code>ping</code> to test connectivity to the IP address provided in the <code>location</code> field.</p><h1 id=disabling-vnc-forwarding-for-linux-vm>Disabling VNC forwarding for Linux VM</h1><p>When creating and destroying Linux VMs, the host agent automatically manages the <code>vncterm</code> processes which convert the text console into VNC. Advanced users who wish to directly access the text console can disable VNC forwarding for that VM. The text console can then only be accessed directly from the control domain directly, and graphical interfaces such as XenCenter will not be able to render a console for that VM.</p><p>Before starting the guest, set the following parameter on the VM record:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ xe vm-param-set uuid<span style=color:#f92672>=</span>$VM other-config:disable_pv_vnc<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span></span></span></code></pre></div><p>Start the VM.</p><p>Use the CLI to retrieve the underlying domain ID of the VM with:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ DOMID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>xe vm-list params<span style=color:#f92672>=</span>dom-id uuid<span style=color:#f92672>=</span>$VM --minimal<span style=color:#66d9ef>)</span></span></span></code></pre></div><p>On the host console, connect to the text console directly by:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ /usr/lib/xen/bin/xenconsole $DOMID</span></span></code></pre></div><p>This configuration is an advanced procedure, and we do not recommend that the text console is directly used for heavy I/O operations. Instead, connect to the guest over SSH or some other network-based connection mechanism.</p><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=vm-importexport>VM import/export</h1><p>VMs can be exported to a file and later imported to any Xapi host. The export
protocol is a simple HTTP(S) GET, which should be sent to the Pool master.
Authorization is either via a pre-created <code>session_id</code> or by HTTP basic
authentication (particularly useful on the command-line).
The VM to export is specified either by UUID or by reference. To keep track of
the export, a task can be created and passed in using its reference. Note that
Xapi may send an HTTP redirect if a different host has better access to the
disk data.</p><p>The following arguments are passed as URI query parameters or HTTP cookies:</p><table><thead><tr><th>Argument</th><th>Description</th></tr></thead><tbody><tr><td>session_id</td><td>the reference of the session being used to authenticate; required only when not using HTTP basic authentication</td></tr><tr><td>task_id</td><td>the reference of the task object with which to keep track of the operation; optional, required only if you have created a task object to keep track of the export</td></tr><tr><td>ref</td><td>the reference of the VM; required only if not using the UUID</td></tr><tr><td>uuid</td><td>the UUID of the VM; required only if not using the reference</td></tr><tr><td>use_compression</td><td>an optional boolean &ldquo;true&rdquo; or &ldquo;false&rdquo; (defaulting to &ldquo;false&rdquo;). If &ldquo;true&rdquo; then the output will be gzip-compressed before transmission.</td></tr></tbody></table><p>For example, using the Linux command line tool cURL:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ curl http://root:foo@myxenserver1/export?uuid<span style=color:#f92672>=</span>&lt;vm_uuid&gt; -o &lt;exportfile&gt;</span></span></code></pre></div><p>will export the specified VM to the file <code>exportfile</code>.</p><p>To export just the metadata, use the URI <code>http://server/export_metadata</code>.</p><p>The import protocol is similar, using HTTP(S) PUT. The <code>session_id</code> and <code>task_id</code> arguments are as for the export. The <code>ref</code> and <code>uuid</code> are not used; a new reference and uuid will be generated for the VM. There are some additional parameters:</p><table><thead><tr><th>Argument</th><th>Description</th></tr></thead><tbody><tr><td>restore</td><td>if <code>true</code>, the import is treated as replacing the original VM - the implication of this currently is that the MAC addresses on the VIFs are exactly as the export was, which will lead to conflicts if the original VM is still being run.</td></tr><tr><td>force</td><td>if <code>true</code>, any checksum failures will be ignored (the default is to destroy the VM if a checksum error is detected)</td></tr><tr><td>sr_id</td><td>the reference of an SR into which the VM should be imported. The default behavior is to import into the <code>Pool.default_SR</code></td></tr></tbody></table><p>Note there is no need to specify whether the export is compressed, as Xapi
will automatically detect and decompress gzip-encoded streams.</p><p>For example, again using cURL:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -T &lt;exportfile&gt; http://root:foo@myxenserver2/import</span></span></code></pre></div><p>will import the VM to the default SR on the server.</p><blockquote><p><strong>Note</strong></p><p>Note that if no default SR has been set, and no <code>sr_uuid</code> is specified, the error message <code>DEFAULT_SR_NOT_FOUND</code> is returned.</p></blockquote><p>Another example:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -T &lt;exportfile&gt; http://root:foo@myxenserver2/import?sr_id<span style=color:#f92672>=</span>&lt;ref_of_sr&gt;</span></span></code></pre></div><p>will import the VM to the specified SR on the server.</p><p>To import just the metadata, use the URI <code>http://server/import_metadata</code></p><h1 id=legacy-vm-import-format>Legacy VM Import Format</h1><p>This section describes the legacy VM import/export format and is for historical
interest only. It should be updated to describe the current format, see
<a href=https://github.com/xapi-project/xapi-project.github.io/issues/64 rel=external target=_blank>issue 64</a></p><p>Xapi supports a human-readable legacy VM input format called XVA. This section describes the syntax and structure of XVA.</p><p>An XVA consists of a directory containing XML metadata and a set of disk images. A VM represented by an XVA is not intended to be directly executable. Data within an XVA package is compressed and intended for either archiving on permanent storage or for being transmitted to a VM server - such as a XenServer host - where it can be decompressed and executed.</p><p>XVA is a hypervisor-neutral packaging format; it should be possible to create simple tools to instantiate an XVA VM on any other platform. XVA does not specify any particular runtime format; for example disks may be instantiated as file images, LVM volumes, QCoW images, VMDK or VHD images. An XVA VM may be instantiated any number of times, each instantiation may have a different runtime format.</p><p>XVA does not:</p><ul><li><p>specify any particular serialization or transport format</p></li><li><p>provide any mechanism for customizing VMs (or templates) on install</p></li><li><p>address how a VM may be upgraded post-install</p></li><li><p>define how multiple VMs, acting as an appliance, may communicate</p></li></ul><p>These issues are all addressed by the related Open Virtual Appliance specification.</p><p>An XVA is a directory containing, at a minimum, a file called <code>ova.xml</code>. This file describes the VM contained within the XVA and is described in Section 3.2. Disks are stored within sub-directories and are referenced from the ova.xml. The format of disk data is described later in Section 3.3.</p><p>The following terms will be used in the rest of the chapter:</p><ul><li><p>HVM: a mode in which unmodified OS kernels run with the help of virtualization support in the hardware.</p></li><li><p>PV: a mode in which specially modified &ldquo;paravirtualized&rdquo; kernels run explicitly on top of a hypervisor without requiring hardware support for virtualization.</p></li></ul><p>The &ldquo;ova.xml&rdquo; file contains the following elements:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;appliance</span> <span style=color:#a6e22e>version=</span><span style=color:#e6db74>&#34;0.1&#34;</span><span style=color:#f92672>&gt;</span></span></span></code></pre></div><p>The number in the attribute &ldquo;version&rdquo; indicates the version of this specification to which the XVA is constructed; in this case version 0.1. Inside the &lt;appliance> there is exactly one &lt;vm>: (in the OVA specification, multiple &lt;vm>s are permitted)</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;vm</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>&gt;</span></span></span></code></pre></div><p>Each <code>&lt;vm></code> element describes one VM. The &ldquo;name&rdquo; attribute is for future internal use only and must be unique within the ova.xml file. The &ldquo;name&rdquo; attribute is permitted to be any valid UTF-8 string. Inside each &lt;vm> tag are the following compulsory elements:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;label&gt;</span>... text ... <span style=color:#f92672>&lt;/label&gt;</span></span></span></code></pre></div><p>A short name for the VM to be displayed in a UI.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;shortdesc&gt;</span> ... description ... <span style=color:#f92672>&lt;/shortdesc&gt;</span></span></span></code></pre></div><p>A description for the VM to be displayed in the UI. Note that for both <code>&lt;label></code> and <code>&lt;shortdesc></code> contents, leading and trailing whitespace will be ignored.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;config</span> <span style=color:#a6e22e>mem_set=</span><span style=color:#e6db74>&#34;268435456&#34;</span> <span style=color:#a6e22e>vcpus=</span><span style=color:#e6db74>&#34;1&#34;</span><span style=color:#f92672>/&gt;</span></span></span></code></pre></div><p>The <code>&lt;config></code> element has attributes which describe the amount of memory in bytes (<code>mem_set</code>) and number of CPUs (VCPUs) the VM should have.</p><p>Each <code>&lt;vm></code> has zero or more <code>&lt;vbd></code> elements representing block devices which look like the following:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;vbd</span> <span style=color:#a6e22e>device=</span><span style=color:#e6db74>&#34;sda&#34;</span> <span style=color:#a6e22e>function=</span><span style=color:#e6db74>&#34;root&#34;</span> <span style=color:#a6e22e>mode=</span><span style=color:#e6db74>&#34;w&#34;</span> <span style=color:#a6e22e>vdi=</span><span style=color:#e6db74>&#34;vdi_sda&#34;</span><span style=color:#f92672>/&gt;</span></span></span></code></pre></div><p>The attributes have the following meanings:</p><ul><li><code>device</code>: name of the physical device to expose to the VM. For linux guests
we use &ldquo;sd[a-z]&rdquo; and for windows guests we use &ldquo;hd[a-d]&rdquo;.</li><li><code>function</code>: if marked as &ldquo;root&rdquo;, this disk will be used to boot the guest.
(NB this does not imply the existence of the Linux root i.e. / filesystem)
Only one device should be marked as &ldquo;root&rdquo;. See Section 3.4 describing VM
booting. Any other string is ignored.</li><li><code>mode</code>: either &ldquo;w&rdquo; or &ldquo;ro&rdquo; if the device is to be read/write or read-only</li><li><code>vdi</code>: the name of the disk image (represented by a <code>&lt;vdi></code> element) to which
this block device is connected</li></ul><p>Each <code>&lt;vm></code> may have an optional <code>&lt;hacks></code> section like the following:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;hacks</span> <span style=color:#a6e22e>is_hvm=</span><span style=color:#e6db74>&#34;false&#34;</span> <span style=color:#a6e22e>kernel_boot_cmdline=</span><span style=color:#e6db74>&#34;root=/dev/sda1 ro&#34;</span><span style=color:#f92672>/&gt;</span></span></span></code></pre></div><p>The <code>&lt;hacks></code> element will be removed in future. The attribute <code>is_hvm</code> is
either <code>true</code> or <code>false</code>, depending on whether the VM should be booted in HVM or not.
The <code>kernel_boot_cmdline</code> contains additional kernel commandline arguments when
booting a guest using pygrub.</p><p>In addition to a <code>&lt;vm></code> element, the <code>&lt;appliance></code> will contain zero or more
<code>&lt;vdi></code> elements like the following:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;vdi</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;vdi_sda&#34;</span> <span style=color:#a6e22e>size=</span><span style=color:#e6db74>&#34;5368709120&#34;</span> <span style=color:#a6e22e>source=</span><span style=color:#e6db74>&#34;file://sda&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;dir-gzipped-chunks&#34;</span><span style=color:#f92672>&gt;</span></span></span></code></pre></div><p>Each <code>&lt;vdi></code> corresponds to a disk image. The attributes have the following meanings:</p><ul><li><code>name</code>: name of the VDI, referenced by the vdi attribute of <code>&lt;vbd></code>elements.
Any valid UTF-8 string is permitted.</li><li><code>size</code>: size of the required image in bytes</li><li><code>source</code>: a URI describing where to find the data for the image, only
file:// URIs are currently permitted and must describe paths relative to the
directory containing the ova.xml</li><li><code>type</code>: describes the format of the disk data</li></ul><p>A single disk image encoding is specified in which has type &ldquo;dir-gzipped-chunks&rdquo;: Each image is represented by a directory containing a sequence of files as follows:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>458286013</span>    Sep <span style=color:#ae81ff>18</span> 09:51 chunk000000000.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>422271283</span>    Sep <span style=color:#ae81ff>18</span> 09:52 chunk000000001.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>395914244</span>    Sep <span style=color:#ae81ff>18</span> 09:53 chunk000000002.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>9452401</span>      Sep <span style=color:#ae81ff>18</span> 09:53 chunk000000003.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>1096066</span>      Sep <span style=color:#ae81ff>18</span> 09:53 chunk000000004.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>971976</span>       Sep <span style=color:#ae81ff>18</span> 09:53 chunk000000005.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>971976</span>       Sep <span style=color:#ae81ff>18</span> 09:53 chunk000000006.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>971976</span>       Sep <span style=color:#ae81ff>18</span> 09:53 chunk000000007.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> dscott xendev <span style=color:#ae81ff>573930</span>       Sep <span style=color:#ae81ff>18</span> 09:53 chunk000000008.gz</span></span></code></pre></div><p>Each file (named &ldquo;chunk-XXXXXXXXX.gz&rdquo;) is a gzipped file containing exactly 1e9 bytes (1GB, not 1GiB) of raw block data. The small size was chosen to be safely under the maximum file size limits of several filesystems. If the files are gunzipped and then concatenated together, the original image is recovered.</p><p>Because the import and export of VMs can take some time to complete, an
asynchronous HTTP interface to the import and export operations is
provided. To perform an export using the XenServer API, construct
an HTTP GET call providing a valid session ID, task ID and VM UUID, as
shown in the following pseudo code:</p><pre><code>task = Task.create()
result = HTTP.get(
  server, 80, &quot;/export?session_id=&amp;task_id=&amp;ref=&quot;);
</code></pre><p>For the import operation, use an HTTP PUT call as demonstrated in the
following pseudo code:</p><pre><code>task = Task.create()
result = HTTP.put(
  server, 80, &quot;/import?session_id=&amp;task_id=&amp;ref=&quot;);
</code></pre><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=vm-lifecycle>VM Lifecycle</h1><p>The following figure shows the states that a VM can be in and the
API calls that can be used to move the VM between these states.</p><pre class="mermaid align-center">graph
    halted-- start(paused) --&gt;paused
    halted-- start(not paused) --&gt;running
    running-- suspend --&gt;suspended
    suspended-- resume(not paused) --&gt;running
    suspended-- resume(paused) --&gt;paused
    suspended-- hard shutdown --&gt;halted
    paused-- unpause --&gt;running
    paused-- hard shutdown --&gt;halted
    running-- clean shutdown\n hard shutdown --&gt;halted
    running-- pause --&gt;paused
    halted-- destroy --&gt;destroyed</pre><h2 id=vm-boot-parameters>VM boot parameters</h2><p>The <code>VM</code> class contains a number of fields that control the way in which the VM
is booted. With reference to the fields defined in the VM class (see later in
this document), this section outlines the boot options available and the
mechanisms provided for controlling them.</p><p>VM booting is controlled by setting one of the two mutually exclusive groups:
&ldquo;PV&rdquo; and &ldquo;HVM&rdquo;. If <code>HVM.boot_policy</code> is an empty string, then paravirtual
domain building and booting will be used; otherwise the VM will be loaded as a
HVM domain, and booted using an emulated BIOS.</p><p>When paravirtual booting is in use, the <code>PV_bootloader</code> field indicates the
bootloader to use. It may be &ldquo;pygrub&rdquo;, in which case the platform&rsquo;s default
installation of pygrub will be used, or a full path within the control domain to
some other bootloader. The other fields, <code>PV_kernel</code>, <code>PV_ramdisk</code>, <code>PV_args</code>,
and <code>PV_bootloader_args</code> will be passed to the bootloader unmodified, and
interpretation of those fields is then specific to the bootloader itself,
including the possibility that the bootloader will ignore some or all of
those given values. Finally the paths of all bootable disks are added to the
bootloader commandline (a disk is bootable if its VBD has the bootable flag set).
There may be zero, one, or many bootable disks; the bootloader decides which
disk (if any) to boot from.</p><p>If the bootloader is pygrub, then the menu.lst is parsed, if present in the
guest&rsquo;s filesystem, otherwise the specified kernel and ramdisk are used, or an
autodetected kernel is used if nothing is specified and autodetection is
possible. <code>PV_args</code> is appended to the kernel command line, no matter which
mechanism is used for finding the kernel.</p><p>If <code>PV_bootloader</code> is empty but <code>PV_kernel</code> is specified, then the kernel and
ramdisk values will be treated as paths within the control domain. If both
<code>PV_bootloader</code> and <code>PV_kernel</code> are empty, then the behaviour is as if
<code>PV_bootloader</code> were specified as &ldquo;pygrub&rdquo;.</p><p>When using HVM booting, <code>HVM_boot_policy</code> and <code>HVM_boot_params</code> specify the boot
handling. Only one policy is currently defined, &ldquo;BIOS order&rdquo;. In this case,
<code>HVM_boot_params</code> should contain one key-value pair &ldquo;order&rdquo; = &ldquo;N&rdquo; where N is the
string that will be passed to QEMU.
Optionally <code>HVM_boot_params</code> can contain another key-value pair &ldquo;firmware&rdquo;
with values &ldquo;bios&rdquo; or &ldquo;uefi&rdquo; (default is &ldquo;bios&rdquo; if absent).
By default Secure Boot is not enabled, it can be enabled when &ldquo;uefi&rdquo; is enabled
by setting <code>VM.platform["secureboot"]</code> to true.</p><ul class="children children-li children-sort-"></ul><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=xencenter>XenCenter</h1><p>XenCenter uses some conventions on top of the XenAPI:</p><h2 id=internationalization-for-sr-names>Internationalization for SR names</h2><p>The SRs created at install time now have an <code>other_config</code> key indicating how their names may be internationalized.</p><p><code>other_config["i18n-key"]</code> may be one of</p><ul><li><p><code>local-hotplug-cd</code></p></li><li><p><code>local-hotplug-disk</code></p></li><li><p><code>local-storage</code></p></li><li><p><code>xenserver-tools</code></p></li></ul><p>Additionally, <code>other_config["i18n-original-value-&lt;field name>"]</code> gives the value of that field when the SR was created. If XenCenter sees a record where <code>SR.name_label</code> equals <code>other_config["i18n-original-value-name_label"]</code> (that is, the record has not changed since it was created during XenServer installation), then internationalization will be applied. In other words, XenCenter will disregard the current contents of that field, and instead use a value appropriate to the user&rsquo;s own language.</p><p>If you change <code>SR.name_label</code> for your own purpose, then it no longer is the same as <code>other_config["i18n-original-value-name_label"]</code>. Therefore, XenCenter does not apply internationalization, and instead preserves your given name.</p><h2 id=hiding-objects-from-xencenter>Hiding objects from XenCenter</h2><p>Networks, PIFs, and VMs can be hidden from XenCenter by adding the key <code>HideFromXenCenter=true</code> to the <code>other_config</code> parameter for the object. This capability is intended for ISVs who know what they are doing, not general use by everyday users. For example, you might want to hide certain VMs because they are cloned VMs that shouldn&rsquo;t be used directly by general users in your environment.</p><p>In XenCenter, hidden Networks, PIFs, and VMs can be made visible, using the View menu.</p><script>for(let e of document.querySelectorAll(".inline-type"))e.innerHTML=renderType(e.innerHTML)</script><footer class=footline></footer></article></section></div></main></div><script src=/new-docs/js/clipboard.min.js?1746630433 defer></script><script src=/new-docs/js/perfect-scrollbar.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-color.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-dispatch.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-drag.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-ease.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-interpolate.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-selection.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-timer.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-transition.min.js?1746630433 defer></script><script src=/new-docs/js/d3/d3-zoom.min.js?1746630433 defer></script><script src=/new-docs/js/js-yaml.min.js?1746630433 defer></script><script src=/new-docs/js/mermaid.min.js?1746630433 defer></script><script>window.themeUseMermaid=JSON.parse('{ "fontFamily": "Roboto Flex", "securityLevel": "loose" }')</script><script src=/new-docs/js/theme.js?1746630433 defer></script><script>function apply_image_invert_filter(e){document.querySelectorAll("img").forEach(function(t){if(t.classList.contains("no-invert"))return;t.style="filter: invert("+e+");"})}function darkThemeUsed(){const t=window.getComputedStyle(document.querySelector("body")),n=t.getPropertyValue("background-color");var e=n.match(/\d+/g).map(function(e){return parseInt(e,10)});return e.length===3&&.2126*e[0]+.7152*e[1]+.0722*e[2]<165}const invertToDarkGray=.85;darkThemeUsed()&&apply_image_invert_filter(invertToDarkGray),document.addEventListener("themeVariantLoaded",function(e){apply_image_invert_filter(e.detail.variant.endsWith("dark")?invertToDarkGray:0)})</script></body></html>